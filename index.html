<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>LXP-L æ‰¹é‡æŸ¥è¯¢ & ç©ºæŠ•ä¼°ç®—</title>
<link rel="icon" href="favicon.ico" />
<style>
:root{
  --c-bg:#fafafa; --c-card:#fff; --c-text:#333; --c-sub:#666;
  --c-primary:#28a745; --c-primary-dark:#1e7e34; --c-error:#e11d48;
}
body{font-family:-apple-system,Segoe UI,PingFang SC,Helvetica,Arial,sans-serif;
  background:var(--c-bg);color:var(--c-text);margin:0;padding:32px}
.container{max-width:800px;margin:auto}
.card{background:var(--c-card);border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.05);
  padding:28px 32px;margin-bottom:40px}
h2{margin:0 0 20px;font-size:24px;display:flex;align-items:center;gap:8px}
h2 .icon{font-size:26px;line-height:1}
textarea{width:100%;height:110px;padding:10px;font-size:14px;border:1px solid #ccc;
  border-radius:6px;resize:vertical;box-sizing:border-box}
button{padding:8px 20px;font-size:15px;border:none;border-radius:6px;
  cursor:pointer;background:var(--c-primary);color:#fff;transition:background .25s}
button:hover{background:var(--c-primary-dark)}button:disabled{opacity:.6;cursor:not-allowed}
input[type="number"],input[type="text"]{padding:6px 8px;font-size:14px;border:1px solid #ccc;
  border-radius:6px;width:180px}
label{font-size:14px;color:var(--c-sub);display:flex;align-items:center;gap:6px;margin:8px 0}
.progress{font-size:14px;color:var(--c-sub);margin-left:10px}
table{width:100%;border-collapse:collapse;margin-top:16px;font-size:14px}
th,td{border:1px solid #e5e7eb;padding:6px;text-align:center}
tbody tr:nth-child(odd){background:#f5f5f5}
.error{color:var(--c-error);font-weight:600}
.summary{margin-top:12px;font-size:15px;line-height:1.7}
.summary strong{color:var(--c-primary)}
.author{position:absolute;top:12px;right:16px;font-size:14px}
.author a{color:var(--c-primary);text-decoration:none}
@media(prefers-color-scheme:dark){
  :root{--c-bg:#111827;--c-card:#1f2937;--c-text:#e5e7eb;--c-sub:#9ca3af}
  table th,table td{border-color:#374151}
  tbody tr:nth-child(odd){background:#1b2431}
}
</style>
</head>
<body>
<div class="author">ä½œè€…æ¨ç‰¹ï¼š<a href="https://x.com/0xXIAOc" target="_blank">@0xXIAOc</a></div>

<div class="container">

  <!-- ===== å¡ç‰‡ 1ï¼šæ‰¹é‡æŸ¥è¯¢ ===== -->
  <div class="card">
    <h2><span class="icon">ğŸŒ±</span>LXP-L ç§¯åˆ†æŸ¥è¯¢ï¼ˆæ”¯æŒæ‰¹é‡åœ°å€ï¼‰</h2>

    <textarea id="addrInput" placeholder="æ¯è¡Œä¸€ä¸ªé’±åŒ…åœ°å€"></textarea>

    <div style="margin-top:12px">
      <button id="queryBtn">æŸ¥è¯¢</button>
      <span id="progress" class="progress"></span>
    </div>

    <div id="queryResult"></div>
    <div id="querySummary" class="summary"></div>
  </div>

  <!-- ===== å¡ç‰‡ 2ï¼šç©ºæŠ•é‡‘é¢ä¼°ç®— ===== -->
  <div class="card">
    <h2><span class="icon">ğŸ¯</span>ç©ºæŠ•é‡‘é¢ä¼°ç®— <small style="font-size:80%;color:var(--c-sub)">by @0xXIAOc</small></h2>

    <label>
      å‡è®¾é¡¹ç›® FDVï¼ˆå®Œå…¨ç¨€é‡Šä¼°å€¼ï¼‰=
      <input id="fdvInput" type="number" value="1000000000" step="1000000"> å…ƒ
    </label>

    <label>
      ä½ æ‹¥æœ‰çš„ LXP-L æ•°é‡=
      <input id="myXpInput" type="number" placeholder="å…ˆæŸ¥è¯¢æˆ–æ‰‹å¡«">
      <span style="font-size:13px;color:var(--c-sub)">â‰ˆ <span id="myXpPct">0</span> %</span>
    </label>

    <label>
      ç©ºæŠ•ç™¾åˆ†æ¯”ï¼ˆå¤šä¸ªç”¨é€—å·åˆ†éš”ï¼‰ï¼š
      <input id="ratioInput" type="text" value="2,3,5">
    </label>

    <button id="calcBtn">è®¡ç®—</button>

    <div id="calcTableWrap"></div>
  </div>

</div>

<script>
/* ===== å¸¸é‡ ===== */
const TOTAL_SUPPLY = 130_700_000_000;   // 1 307 äº¿ LXP-L
const CONCURRENCY  = 5;

/* ===== DOM ===== */
const queryBtn   = document.getElementById('queryBtn');
const progressEl = document.getElementById('progress');
const queryResEl = document.getElementById('queryResult');
const querySumEl = document.getElementById('querySummary');

const fdvInput   = document.getElementById('fdvInput');
const myXpInput  = document.getElementById('myXpInput');
const ratioInput = document.getElementById('ratioInput');
const myXpPctEl  = document.getElementById('myXpPct');
const calcBtn    = document.getElementById('calcBtn');
const calcWrap   = document.getElementById('calcTableWrap');

/* ===== æ‰¹é‡æŸ¥è¯¢ ===== */
queryBtn.onclick = async () => {
  const addrs = document.getElementById('addrInput').value.trim()
                  .split(/\s+/).filter(Boolean);
  if (!addrs.length) return;

  queryBtn.disabled = true;
  progressEl.textContent = `0 / ${addrs.length}`;

  queryResEl.innerHTML = `<table>
    <thead><tr><th>#</th><th>åœ°å€</th><th>LXP-L</th><th>æ’å</th></tr></thead><tbody></tbody></table>`;
  const tbody = queryResEl.querySelector('tbody');
  querySumEl.textContent = '';

  let cursor=0, done=0, totalXp=0;

  async function worker(){
    while(cursor<addrs.length){
      const i=cursor++;
      const addr = addrs[i].toLowerCase();
      try{
        const r = await fetch(`/api/points?user=${addr}`);
        if(!r.ok) throw new Error(r.status);
        const t=await r.text(), d=t?JSON.parse(t):{};
        const o = Array.isArray(d)?d[0]:d?.[0]??d;
        const xp=Number(o?.xp??0), rk=o?.rank_xp??'-';
        totalXp += xp;
        addRow(i,addr,xp?xp.toLocaleString():'-',rk);
      }catch(e){
        addRow(i,addr,'â€”','æŸ¥è¯¢å¤±è´¥',true);
      }finally{
        progressEl.textContent=`${++done} / ${addrs.length}`;
      }
    }
  }
  function addRow(i,a,xp,rk,err=false){
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${i+1}</td><td>${a}</td>
      <td${err?' class="error"':''}>${xp}</td>
      <td${err?' class="error"':''}>${rk}</td>`;
    tbody.appendChild(tr);
  }
  await Promise.all(Array.from({length:CONCURRENCY},worker));
  progressEl.textContent+=' âœ”';
  queryBtn.disabled=false;

  querySumEl.innerHTML=`<strong>å·²æŸ¥è¯¢åœ°å€ï¼š</strong>${addrs.length} ä¸ª<br>
    <strong>LXP-L æ€»å’Œï¼š</strong>${totalXp.toLocaleString()}`;
  myXpInput.value = totalXp || '';
  myXpPctEl.textContent = ((totalXp / TOTAL_SUPPLY)*100).toFixed(2);
};

/* ===== ç©ºæŠ•ä¼°ç®— ===== */
calcBtn.onclick = () => {
  const xp   = Number(myXpInput.value)||0;
  const fdv  = Number(fdvInput.value)||0;
  const ratios = ratioInput.value.split(',')
                .map(s=>Number(s.trim())/100).filter(n=>n>0);
  if(!xp || !fdv || !ratios.length){
    alert('è¯·ç¡®ä¿ FDVã€ç©ºæŠ•æ¯”ä¾‹å’Œ LXP-L æ•°é‡å‡æœ‰æ•ˆ');return;
  }

  const tokenPrice = fdv / TOTAL_SUPPLY;  // æ¯ LXP-L ä»·æ ¼
  const rows = ratios.map(r=>{
    const usd   = xp * r * tokenPrice;
    const token = xp * r;
    const usdWan= usd / 10000;
    return `<tr>
      <td>${(r*100).toFixed(2)}%</td>
      <td>${usdWan.toFixed(2)}</td>
      <td>${token.toLocaleString(undefined,{maximumFractionDigits:0})}</td>
      <td>${tokenPrice.toFixed(6)}</td>
      <td>${usd.toFixed(2)}</td>
    </tr>`;
  }).join('');
  calcWrap.innerHTML = `<table>
    <thead><tr><th>ç©ºæŠ•ç™¾åˆ†æ¯”</th><th>ç©ºæŠ•é‡‘é¢ (ä¸‡å…ƒ)</th>
    <th>å¯åˆ†é…ä»£å¸æ•°é‡ (æš)</th><th>æ¯ LXP-L ä»·æ ¼ (USD)</th><th>ä½ çš„ç©ºæŠ•ä»·å€¼ (USD)</th></tr></thead>
    <tbody>${rows}</tbody></table>`;
};
</script>
</body>
</html>
